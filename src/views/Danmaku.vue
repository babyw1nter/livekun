<template>
  <div class="danmaku">
    <GiftCapsulePanel ref="GiftCapsulePanelRef" :maximum="5" style="margin-bottom: 1rem;"></GiftCapsulePanel>

    <div style="margin-bottom: 1rem;">
      <a-button type="primary" @click="add">add</a-button>
    </div>

    <ChatMessageList :list="msgList" style="width: 300px; height: 502px;"> </ChatMessageList>

    <GiftCardPanel :list="list" style="width: 300px; height: 330px;"> </GiftCardPanel>
  </div>
</template>

<script lang="ts">
import { Component, defineComponent, onMounted, ref } from 'vue'
import GiftCapsulePanel from '@/components/GiftCapsulePanel.vue'
import ChatMessageList from '@/components/ChatMessageList.vue'
import GiftCardPanel from '@/components/GiftCardPanel.vue'

const randomNum = (minNum: number, maxNum: number) => {
  return parseInt((Math.random() * (maxNum - minNum + 1) + minNum).toString(), 10)
}

const _l = [
  {
    nickname: '91çŽ‹å…ˆç”Ÿ',
    avatarUrl: 'https://img0.baidu.com/it/u=1536857165,2921056634&fm=26&fmt=auto&gp=0.jpg',
    money: 666,
    uid: 3312,
    timeout: 100000,
    type: 2
  },
  {
    nickname: 'Pornhubå¤§æ³¢å¦¹',
    avatarUrl: 'https://img2.baidu.com/it/u=222120700,1745793916&fm=26&fmt=auto&gp=0.jpg',
    money: 99,
    uid: 444,
    timeout: 100000,
    type: 0
  },
  {
    nickname: 'CCå¥¶çµ',
    avatarUrl: 'https://z3.ax1x.com/2021/08/11/ftOL4K.png',
    money: 69,
    uid: 6900,
    timeout: 100000,
    type: 1
  },
  {
    nickname: 'â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„',
    avatarUrl: 'https://img0.baidu.com/it/u=1355519613,4273607392&fm=26&fmt=auto&gp=0.jpg',
    money: 1,
    uid: 3333,
    timeout: 100000,
    type: 1
  },
  {
    nickname: '^_^ä»€ä¹ˆæƒ…å†µï¼Ÿ',
    avatarUrl:
      'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fp3.itc.cn%2Fq_70%2Fimages03%2F20201204%2F94e9c0568b6b40d28b2111ea9b2f8062.jpeg&refer=http%3A%2F%2Fp3.itc.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1631209669&t=b071b5f523fe602514c220bf892c65cd',
    money: 1,
    uid: 6696,
    timeout: 100000,
    type: 1
  }
]

export default defineComponent({
  components: { GiftCardPanel, GiftCapsulePanel, ChatMessageList },
  setup() {
    const list = ref([
      {
        nickname: 'Pornhubå¤§æ³¢å¦¹',
        avatarUrl: 'https://img2.baidu.com/it/u=222120700,1745793916&fm=26&fmt=auto&gp=0.jpg',
        money: 30,
        message: 'èµ é€äº†å¥¶ç½© Ã— 1',
        type: 0
      },
      {
        nickname: 'CCå¥¶çµ',
        avatarUrl: 'https://z3.ax1x.com/2021/08/11/ftOL4K.png',
        money: 69,
        message: 'èµ é€äº†ç«ç®­ Ã— 1',
        type: 1
      },
      {
        nickname: '91çŽ‹å…ˆç”Ÿ',
        avatarUrl: 'https://img0.baidu.com/it/u=1536857165,2921056634&fm=26&fmt=auto&gp=0.jpg',
        money: 666,
        message: 'èµ é€äº†åœ£æ—¨é™ä¸´ Ã— 1',
        type: 2
      },
      {
        nickname: 'â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„',
        avatarUrl: 'https://img0.baidu.com/it/u=1355519613,4273607392&fm=26&fmt=auto&gp=0.jpg',
        money: 99,
        message: 'å¼€é€šäº†æœˆè´¹å®ˆæŠ¤',
        type: 3
      },
      {
        nickname: '^_^ä»€ä¹ˆæƒ…å†µï¼Ÿ',
        avatarUrl:
          'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fp3.itc.cn%2Fq_70%2Fimages03%2F20201204%2F94e9c0568b6b40d28b2111ea9b2f8062.jpeg&refer=http%3A%2F%2Fp3.itc.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1631209669&t=b071b5f523fe602514c220bf892c65cd',
        money: 588,
        message: 'å¼€é€šäº†å¹´è´¹å®ˆæŠ¤',
        type: 4
      }
    ])

    // æŽ’åº
    // list.value.sort((a, b) => b.money - a.money)

    const msgList = ref([
      {
        nickname: '^_^ä»€ä¹ˆæƒ…å†µï¼Ÿ',
        avatarUrl:
          'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fp3.itc.cn%2Fq_70%2Fimages03%2F20201204%2F94e9c0568b6b40d28b2111ea9b2f8062.jpeg&refer=http%3A%2F%2Fp3.itc.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1631209669&t=b071b5f523fe602514c220bf892c65cd',
        message:
          'è°èƒ½å‘Šè¯‰æˆ‘çŽ°åœ¨æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿè°èƒ½å‘Šè¯‰æˆ‘çŽ°åœ¨æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šæˆ‘æ˜¯è°æˆ‘åœ¨å“ªï¼Ÿ',
        type: 0
      },
      {
        nickname: 'â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„',
        avatarUrl: 'https://img0.baidu.com/it/u=1355519613,4273607392&fm=26&fmt=auto&gp=0.jpg',
        message: 'äººç”Ÿçš„æ„ä¹‰å°±æ˜¯ä¸ºäº†å¥¶é“ƒçš„ç™½ä¸(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»',
        type: 3
      },
      {
        nickname: 'â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„',
        avatarUrl: 'https://img0.baidu.com/it/u=1355519613,4273607392&fm=26&fmt=auto&gp=0.jpg',
        message: 'ðŸ˜å¦‚æžœæ²¡æœ‰å¥¶é“ƒçš„ç™½ä¸ï¼Œä¸–ç•Œå°±å¤±åŽ»äº†è‰²å½©ðŸ˜¿ðŸ˜¿ðŸ˜¿ðŸ˜¿ï¼Ÿï¼Ÿï¼',
        type: 3
      },
      {
        nickname: 'â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„',
        avatarUrl: 'https://img0.baidu.com/it/u=1355519613,4273607392&fm=26&fmt=auto&gp=0.jpg',
        message: 'æ‰€ä»¥æˆ‘å¸Œæœ›æ¯å¤©èƒ½çœ‹åˆ°å¥¶é“ƒç©¿ç™½ä¸ç›´æ’­ï¼Œè¿™æ ·æˆ‘ä¼šéžå¸¸æ»¡è¶³ï¼',
        type: 3
      },
      {
        nickname: 'CCå¥¶çµ',
        avatarUrl: 'https://z3.ax1x.com/2021/08/11/ftOL4K.png',
        message: 'ã€‚ã€‚ã€‚æ»šï¼ï¼~',
        type: 1
      },
      {
        nickname: 'CCå¥¶çµ',
        avatarUrl: 'https://z3.ax1x.com/2021/08/11/ftOL4K.png',
        message: 'ðŸ˜¡ðŸ˜¡ðŸ˜¡',
        type: 1
      },
      {
        nickname: 'Pornhubå¤§æ³¢å¦¹',
        avatarUrl: 'https://img2.baidu.com/it/u=222120700,1745793916&fm=26&fmt=auto&gp=0.jpg',
        message: 'å“ˆå“ˆ',
        type: 0
      },
      {
        nickname: 'Pornhubå¤§æ³¢å¦¹',
        avatarUrl: 'https://img2.baidu.com/it/u=222120700,1745793916&fm=26&fmt=auto&gp=0.jpg',
        message: 'æˆ‘çˆ±å¥¶é“ƒä¸€ç”Ÿä¸€ä¸–',
        type: 0
      }
    ])

    let i = 0
    setInterval(() => {
      if (i >= 6) i = 0
      msgList.value.push(msgList.value[i])
      i++
    }, 3000)

    const GiftCapsulePanelRef = ref<InstanceType<typeof GiftCapsulePanel>>()

    const add = () => {
      GiftCapsulePanelRef.value?.add({
        ..._l[randomNum(0, 4)],
        money: randomNum(1, 100),
        duration: 10000
      })
    }

    return { list, msgList, GiftCapsulePanelRef, add }
  }
})
</script>

<style lang="less">
.danmaku {
  padding: 10px;
}
</style>
